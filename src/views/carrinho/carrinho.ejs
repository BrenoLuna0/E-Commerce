<!DOCTYPE html>
<html lang="en">

<head>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
    integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
  <title>Carrinho</title>
  <link rel="icon" href="/assets/favicon.ico">
  <script src="https://kit.fontawesome.com/415900c0c9.js" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/css/produtos.css">
  <link rel="stylesheet" href="/css/carrinho.css">

</head>

<body>

  <main role="main">
    <div class="container">
      <div class="row">
        <div class="col-md">
          <p>
            <figure>
              <a href="/main"><img src="/assets/logo_vip_informatica.png" alt="Minha Figura"></a>
            </figure>
          </p>
        </div>
        <div class="col-6 center">
          <form action="/descricao/?page=1" method="GET">
            <div class="form-row">
              <div class="col">
                <input type="text" id="descricao" name="descricao" class="form-control"
                  placeholder="Pesquise Seus Produtos">
              </div>
              <div class="col">
                <button type="submit" class="">Pesquisar</button>
              </div>
            </div>
          </form>
        </div>
        <div class="col-md center">
          <div class="row">
            <div class="col">
              <p>
                <a class="color" href="/historico"><i class="fas fa-user">Historico</i></a>
                <a class="color" href="/carrinho"><i class="fas fa-shopping-cart"><%='Carrinho' + cartTotal%></i></a>
              </p>
            </div>
            <div class="col">
              <p class="text-right">
                <a class="color" href="/logout"><i class="fas fa-sign-out-alt">Sair</i></a>
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <nav class="navbar navbar-expand-lg navbar-dark">
      <div class="container">
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav nav-fill w-100">
            <li class="nav-item active ">
              <a class="nav-link" href="/produto?page=1">Produtos <span class="sr-only">(current)</span></a>
            </li>
            <li class="nav-item active dropdown">
              <a class="nav-link dropdown-toggle dropbtn" href="#" id="navbarDropdown" role="button"
                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Computador
              </a>
              <div class="dropdown-menu dropdown-content" aria-labelledby="navbarDropdown">
                <a class="dropdown-item" href="#">Action</a>
                <a class="dropdown-item" href="#">Another action</a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" href="#">Something else here</a>
              </div>
            </li>
            <li class="nav-item active dropdown">
              <a class="nav-link dropdown-toggle dropbtn" href="#" id="navbarDropdown" role="button"
                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Acessórios
              </a>
              <div class="dropdown-menu dropdown-content" aria-labelledby="navbarDropdown">
                <a class="dropdown-item" href="#">Action</a>
                <a class="dropdown-item" href="#">Another action</a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" href="#">Something else here</a>
              </div>
            </li>
            <li class="nav-item active dropdown">
              <a class="nav-link dropdown-toggle dropbtn" href="#" id="navbarDropdown" role="button"
                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Impressoras
              </a>
              <div class="dropdown-menu dropdown-content" aria-labelledby="navbarDropdown">
                <a class="dropdown-item" href="#">Action</a>
                <a class="dropdown-item" href="#">Another action</a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" href="#">Something else here</a>
              </div>
            </li>
            <li class="nav-item active dropdown">
              <a class="nav-link dropdown-toggle dropbtn" href="#" id="navbarDropdown" role="button"
                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Telefonia
              </a>
              <div class="dropdown-menu dropdown-content" aria-labelledby="navbarDropdown">
                <a class="dropdown-item" href="#">Action</a>
                <a class="dropdown-item" href="#">Another action</a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" href="#">Something else here</a>
              </div>
            </li>
            <li class="nav-item active dropdown">
              <a class="nav-link dropdown-toggle dropbtn" href="#" id="navbarDropdown" role="button"
                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Notebooks
              </a>
              <div class="dropdown-menu dropdown-content" aria-labelledby="navbarDropdown">
                <a class="dropdown-item" href="#">Action</a>
                <a class="dropdown-item" href="#">Another action</a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" href="#">Something else here</a>
              </div>
            </li>
            <li class="nav-item active dropdown">
              <a class="nav-link dropdown-toggle dropbtn" href="#" id="navbarDropdown" role="button"
                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Televisão
              </a>
              <div class="dropdown-menu dropdown-content" aria-labelledby="navbarDropdown">
                <a class="dropdown-item" href="#">Action</a>
                <a class="dropdown-item" href="#">Another action</a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" href="#">Something else here</a>
              </div>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <div class="container full">
      <div class="full">
        <div class="">
          <table class="table table-hover">
            <thead>
              <tr>
                <th>Produto</th>
                <th>Quantidade</th>
                <th class="text-center">Preço</th>
                <th class="text-center">SubTotal</th>
                <th> </th>
                <th> </th>
              </tr>
            </thead>
            <tbody>
              <%
                                let total = 0;
                                if(produtos){
                                    produtos.map(function(produto){

                                        %>

              <tr>
                <td class="col-sm-8 col-md-6">
                  <div class="media">
                    <a class="thumbnail pull-left" href=<%='/produto/' + produto.codigo%>> <img class="media-object"
                        src=<%=produto.path%> style="width: 72px; height: 72px;"> </a>
                    <div class="media-body">
                      <h5 class="media-heading"><a href=<%='/produto/' + produto.codigo%>><%=produto.nome%></a></h5>
                    </div>
                  </div>
                </td>
                <td class="col-sm-1 col-md-1" style="text-align: center">
                  <form>
                    <input type="hidden" name="produto" value=<%=produto.codigo%>>
                    <input type="number" class="form-control" name="qtd" id=<%='qtd'+ produto.codigo%> min="1"
                      value=<%=produto.qtd%>>
                  </form>
                </td>
                <td class="col-sm-1 col-md-1 text-center"><strong><%=produto.preco.toLocaleString('pt-br', { style: 'currency', currency: 'BRL' })%></strong></td>
                <td class="col-sm-1 col-md-1 text-center"><strong><%=produto.subtotal.toLocaleString('pt-br', { style: 'currency', currency: 'BRL' })%></strong></td>
                <td class="col-sm-1 col-md-1">
                  <form>
                    <input type="hidden" name="produto" value=<%=produto.codigo%>>
                    <button type="button" style="background-color: #333333;"
                      onclick="removerDoCarrinho('<%=produto.codigo%>')" class="">
                      <span class="glyphicon glyphicon-remove"></span> Remover
                    </button>
                  </form>
                </td>
                <td class="col-sm-1 col-md-1">
                  <button type="button" style="background-color: #0f0f57;"
                    onclick="atualizarCarrinho('<%=produto.codigo%>')" class="">
                    <span class="glyphicon glyphicon-remove"></span> Atualizar
                  </button>
                </td>
              </tr>

              <%

                                        total += produto.subtotal;
                                    })
                                }%>
              <tr>
                <td>   </td>
                <td>   </td>
                <td>   </td>
                <td> </td>
                <td>
                  <h3>Total</h3>
                </td>
                <td class="text-right">
                  <h3><strong><%=total.toLocaleString('pt-br', { style: 'currency', currency: 'BRL' })%></strong></h3>
                </td>
              </tr>
              <tr>
                <td>   </td>
                <td>   </td>
                <td>   </td>
                <td> </td>
                <td>
                  <button type="button" class="btn btn-default bg-light" onclick="location.href='/main';">
                    <span class="glyphicon glyphicon-shopping-cart"></span> Continue Comprando
                  </button></td>
                <td>
                  <button type="button" class="" onclick="location.href='/checkout';">
                    Finalizar Compra <span class="glyphicon glyphicon-play"></span>
                  </button></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
    <hr>

    <!--Grid row-->
    <div class="row d-flex justify-content-center wow fadeIn">

      <!--Grid column-->
      <div class="col-md-6 text-center">

        <h4 class="my-4 h4">Produtos Relacionados</h4>

        <p>Consumidores geralmente levam os seguintes itens também</p>

      </div>
      <!--Grid column-->

    </div>
    <!--Grid row-->

    <!--Grid row-->
    <div class="row wow fadeIn">

      <!--Grid column-->
      <%
        produtosRelacionados.map(function(produto){
          %>

      <div class="col-md-4">
        <div>
          <div class="card mb-4 shadow-sm">
            <div class="card-body" onclick="showProduct('<%=produto.PROD_CODIGO%>')">
              <div id=<%='alert'+produto.PROD_CODIGO%> class="alert alert-success alert-dismissible text-center"
                role="alert">
                <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
                Produto adicionado no carrinho. <a href="/carrinho" class="alert-link">Clique aqui para ver seu
                  carrinho</a>.
              </div>
              <img src=<%=produto.PROD_IMAG_PATH%>>
              <p onclick="event.stopPropagation()"><strong><%=produto.PROD_DESCRICAO%></strong></p>
              <p onclick="event.stopPropagation()"><strong><%=produto.PROD_PRECO.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})%></strong></p>
              <div>
                <button onclick="event.stopPropagation();adicionarNoCarrinho('<%=produto.PROD_CODIGO%>')" class=""
                  id=<%='button'+produto.PROD_CODIGO %>>Adicionar
                  ao Carrinho</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <%
        })
        %>



    </div>
  </main>

  <footer class="page-footer font-small blue pt-4 text-center">
    <!-- Copyright -->
    <p class="text-light"><strong>Filial: <%=filial%></strong></p>
    <div class="footer-copyright text-center text-light">© 2020 Copyright:
      <a class="text-light" href="https://csmti.com.br"> CSM Tecnologia da Informação</a>
    </div><br>
    <!-- Copyright -->

  </footer>


  <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
    integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
    crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
    integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
    crossorigin="anonymous"></script>

  <script>

    function removerDoCarrinho(idProduto) {

      $.ajax({
        url: '/carrinho/remove',
        type: 'DELETE',
        data: { produto: idProduto },
        success: function (response) {
          if (response) {
            console.log('Deu certo');
          } else {
            console.log('Deu Errado');
          }

        }
      });

      location.reload();

    }

    function atualizarCarrinho(idProduto) {
      const qtd = $('#qtd' + idProduto).val();
      const qtdNumber = parseInt(qtd);

      $.ajax({
        url: '/carrinho/update',
        type: 'PUT',
        data: { produto: idProduto, qtd: qtdNumber },
        success: function (response) {
          if (response) {
            console.log('Deu certo');
          } else {
            console.log('Deu Errado');
          }

        }
      });

      location.reload();

    }

  </script>
  <script src="/js/scripts.js"></script>

</body>

</html>